# LIPS スクレイピング設計詳細（Octoparse）

## 目的
LIPSの最新投稿一覧に表示されている複数投稿を対象に、  
**投稿情報＋ユーザープロフィール＋登録済みSNSリンク**を  
安定して取得できるスクレイピング設計を構築する。

単発取得ではなく、  
「実運用で回し続けること」を前提とした設計を目的とする。

---

## 対象サイトの難しさ
LIPSは、スクレイピング観点で以下の特徴を持つ。

- 投稿数が多く、最新一覧が高速で更新される
- 一覧 / 投稿詳細 / プロフィールでDOM構造が完全に異なる
- 同一URLでも、遷移タイミングによってDOMが未構築の状態が発生する
- SNSリンクは「未登録の場合、HTML上に要素自体が存在しない」

そのため、
- 一覧取得のみ
- 固定XPathによる一括取得  
では、**取得漏れ・誤取得・不安定動作が発生しやすい**。

---

## 全体フロー
1. 最新投稿一覧ページにアクセス
2. 投稿カードをループ処理
3. 各投稿の詳細ページへ遷移
4. 投稿日・投稿URL・ユーザーURLを取得
5. ユーザープロフィールページへ遷移
6. SNSリンクを取得（存在するもののみ）
7. 次の投稿へ進む

---

## 設計上の重要判断

### 判断①：一覧・詳細・プロフィールを完全に分離
**理由**
- 各ページでDOM構造が異なる
- 同一XPathを流用すると誤取得が発生する

**対応**
- Octoparse上でWebページを明確に分けて定義
- ページごとに取得フィールドを作成

---

### 判断②：クリック遷移とURL遷移を使い分け
**理由**
- 一部ページは直URL指定だとDOMが構築されないケースがある
- クリック遷移の方が安定する場面が存在する

**対応**
- 一覧 → 詳細：クリック遷移
- 詳細 → プロフィール：URL遷移
- 状況に応じて遷移方法を切り替え

---

### 判断③：固定遅延に頼らない
**理由**
- 固定秒数待機では、通信状況により取得失敗が起きる
- 遅延を長くすると全体実行時間が肥大化する

**対応**
- ページ遷移後に対象要素を取得する設計
- 要素が取得できない場合は「未取得」として処理継続

---

## SNSリンク取得の考え方（重要）

### 前提
- SNSリンクは、ユーザーが登録していない場合、HTML上に存在しない
- 無理に取得しようとすると、公式アカウント等を誤取得するリスクがある

### 方針
- プロフィール領域に限定したXPathを使用
- 要素が存在しない場合は **空欄が正解** と判断
- 「取得できない = 失敗」としない

### 対象SNS
- Instagram
- X（旧Twitter）
- YouTube
- TikTok
- Webサイト

---

## 重複・品質に対する考え方
- 同一投稿を複数回取得しない構造を前提
- 後続処理（Google Sheets / GAS）での重複排除を想定
- スクレイピング側では「正しい一次データ取得」に集中

---

## 取得データ構造（ダミー）

```json
{
  "post_url": "https://lipscosme.com/posts/xxxxxxx",
  "posted_at": "2026-01-12",
  "user_name": "sample_user",
  "profile_url": "https://lipscosme.com/users/@sample",
  "instagram": "https://www.instagram.com/sample/",
  "x": "",
  "youtube": "",
  "tiktok": "",
  "website": ""
}
